{% extends 'core/base.html' %}

{% block title %}Главная{% endblock %}

{% block content %}
<div class="mb-4 animate__animated animate__fadeInDown">
    <form method="get" class="d-flex">
        <input type="text" name="q" class="form-control me-2" placeholder="Поиск по логину или теме..." value="{{ query }}">
        <button type="submit" class="btn btn-danger">Искать</button>
    </form>
</div>

<h1 class="mb-3 animate__animated animate__fadeInLeft text-white">
    {% if query %}Результаты поиска по "{{ query }}"{% else %}Рекомендации{% endif %}
</h1>

<!-- Пины -->
<h2 class="mt-4 animate__animated animate__fadeInUp text-white">Пины</h2>
<div class="row">
    {% for pin in pins %}
        <div class="col-md-4 mb-3 animate__animated animate__fadeInUp">
            <div class="card hover-scale" style="background-color:#1a1a1a; border-radius:12px;">
                {% if pin.image %}
                    <img src="{{ pin.image.url }}" class="card-img-top hover-wave" alt="{{ pin.title }}">
                {% elif pin.video %}
                    <video src="{{ pin.video.url }}" class="card-img-top" controls></video>
                {% endif %}
                <div class="card-body">
                    <h5 style="color:#4cc9f0;">{{ pin.title }}</h5>
                    <p class="text-white">{{ pin.description }}</p>
                    <p class="text-white">Теги: {{ pin.tags.all|join:", " }}</p>
                    <small class="text-white">
                        От:
                        <a href="{% url 'user_profile' pin.user.username %}" style="color:#b5179e;">
                            {{ pin.user.profile.display_name|default:pin.user.username }}
                        </a>
                    </small>
                </div>
            </div>
        </div>
    {% empty %}
        <p class="text-white">Нет пинов.</p>
    {% endfor %}
</div>

<!-- Пользователи -->
{% if users %}
    <h3 class="mt-5 animate__animated animate__fadeInRight text-white">Рекомендации пользователей</h3>
    <div class="row mb-4">
        {% for user in users %}
            <div class="col-md-4 mb-3 animate__animated animate__zoomIn">
                <div class="card text-center hover-bounce" style="background-color:#1a1a1a; border-radius:12px;">
                    {% if user.profile.avatar %}
                        <img src="{{ user.profile.avatar.url }}"
                             class="card-img-top rounded-circle mx-auto mt-3 hover-wave"
                             style="width: 100px; height: 100px; object-fit: cover; border:2px solid #ffffff;">
                    {% else %}
                        <div class="rounded-circle mx-auto mt-3"
                             style="width: 100px; height: 100px; background-color:#ffffff;"></div>
                    {% endif %}
                    <div class="card-body">
                        <h5 class="card-title text-white">
                            {{ user.profile.display_name|default:user.username }}
                        </h5>
                        <a href="{% url 'user_profile' user.username %}" class="btn btn-outline-primary">Посмотреть профиль</a>
                    </div>
                </div>
            </div>
        {% endfor %}
    </div>
{% endif %}
{% endblock %}
